<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Video GÃ¶rÃ¼ÅŸme & Ekran PaylaÅŸÄ±mÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; margin: 0; padding: 0; }
        .video-mirror { transform: scaleX(-1); }

        /* Ana video - KarÅŸÄ± taraf */
        #remoteVideoContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: black;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #remoteVideo {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Yerel video - SaÄŸ alt kÃ¶ÅŸe */
        #localVideoBox {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 160px;
            height: 90px;
            z-index: 1000; /* Ã‡OK YÃœKSEK - her zaman Ã¼stte */
            border: 3px solid #4b5563;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.8);
            background: black;
            transition: all 0.3s;
        }

        /* Tam ekran modunda kÃ¼Ã§Ã¼k kamerayÄ± biraz daha kÃ¼Ã§Ã¼lt */
        body:fullscreen #localVideoBox {
            width: 140px;
            height: 80px;
            bottom: 15px;
            right: 15px;
        }

        #localVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .label {
            position: absolute;
            bottom: 4px;
            left: 4px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 4px;
            z-index: 2;
        }

        /* Kontrol Paneli - Sol Ã¼st kÃ¶ÅŸe */
        .control-panel {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 900; /* YÃ¼ksek ama kamera altÄ±nda */
            background: rgba(31, 41, 55, 0.95);
            padding: 12px;
            border-radius: 12px;
            max-width: 280px;
            backdrop-filter: blur(4px);
            border: 1px solid #4b5563;
            transition: opacity 0.3s;
        }

        /* Tam ekranda kontrol panelini gizle */
        body:fullscreen .control-panel {
            opacity: 0.1;
        }

        /* Fare Ã¼zerine gelince gÃ¶ster */
        body:fullscreen .control-panel:hover {
            opacity: 0.95;
        }

        .control-panel input, .control-panel button {
            margin-top: 6px;
            width: 100%;
        }

        .control-panel .flex-row {
            display: flex;
            gap: 6px;
        }

        .control-panel .flex-row > * {
            flex: 1;
        }

        /* Tam ekran butonu - GÃ–RÃœNÃœR OLMALI */
        #fullscreenBtn {
            position: fixed;
            bottom: 140px;
            right: 20px;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            z-index: 800;
            display: none; /* BaÅŸlangÄ±Ã§ta gizli, ekran paylaÅŸÄ±mÄ±nda gÃ¶rÃ¼nÃ¼r */
            transition: all 0.3s;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        #fullscreenBtn:hover {
            background: rgba(16, 185, 129, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        /* Ekran paylaÅŸÄ±m bilgi mesajÄ± */
        .screen-share-notice {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            color: #10B981;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            z-index: 800;
            display: none;
            border: 2px solid #10B981;
            animation: pulse 2s infinite;
            font-weight: bold;
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        /* Durum mesajÄ± */
        #status {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 700;
            font-size: 0.8rem;
            color: #d1d5db;
            background: rgba(0,0,0,0.8);
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 90px;
            border: 1px solid #4b5563;
        }

        /* Tam ekranda durum mesajÄ±nÄ± gizle */
        body:fullscreen #status {
            opacity: 0.3;
        }

        /* Ekran paylaÅŸÄ±m sahnesi (sadece siz gÃ¶rÃ¼rsÃ¼nÃ¼z) */
        #screenShareStage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #111827;
            z-index: 5;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        #screenVideo {
            max-width: 90%;
            max-height: 80%;
            object-fit: contain;
            border: 3px solid #374151;
            border-radius: 8px;
        }

        /* Tam ekran Ã§Ä±kÄ±ÅŸ butonu - HER ZAMAN GÃ–RÃœNÃœR OLMALI */
        #exitFullscreenBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1000; /* EN YÃœKSEK */
            display: none; /* BaÅŸlangÄ±Ã§ta gizli */
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        
        #exitFullscreenBtn:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.05);
        }

        /* Basit data channel mesajlarÄ± iÃ§in */
        .data-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- KarÅŸÄ± TarafÄ±n Videosu - BURAYA EKRAN PAYLAÅIMI GELECEK -->
    <div id="remoteVideoContainer">
        <video id="remoteVideo" autoplay playsinline></video>
    </div>

    <!-- Ekran paylaÅŸÄ±m bilgi mesajÄ± -->
    <div class="screen-share-notice" id="screenShareNotice">
        ğŸ“º Ekran PaylaÅŸÄ±mÄ± Ä°zleniyor
    </div>
    
    <!-- Tam ekran butonu -->
    <button id="fullscreenBtn" onclick="toggleFullscreen()">
        ğŸ”² Tam Ekran Yap
    </button>
    
    <!-- Tam ekrandan Ã§Ä±kÄ±ÅŸ butonu -->
    <button id="exitFullscreenBtn" onclick="exitFullscreen()">
        âœ• Tam Ekrandan Ã‡Ä±k
    </button>

    <!-- Yerel Video (Sen) -->
    <div id="localVideoBox">
        <video id="localVideo" autoplay muted playsinline class="video-mirror"></video>
        <div class="label">Sen</div>
    </div>

    <!-- Kontrol Paneli -->
    <div class="control-panel">
        <div class="text-sm text-gray-300 mb-1">Senin ID'n:</div>
        <div id="myId" class="font-mono text-green-400 mb-2 truncate">...</div>

        <input type="text" id="remoteIdInput" placeholder="KarÅŸÄ± ID" 
               class="p-2 rounded bg-gray-700 text-white border border-gray-600 text-sm">
        <input type="password" id="passwordInput" placeholder="Åifre" 
               class="p-2 rounded bg-gray-700 text-white border border-gray-600 mt-1 text-sm">

        <div class="flex-row mt-2">
            <button onclick="connectToPeer()" 
                    class="p-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded text-sm transition-colors">
                BaÄŸlan
            </button>
            <button onclick="toggleScreenShare()" id="shareBtn" 
                    class="p-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded text-sm flex items-center justify-center gap-1 transition-colors">
                <span id="shareIcon">ğŸ“º</span>
                <span id="shareBtnText">PaylaÅŸ</span>
            </button>
        </div>
    </div>

    <!-- Ekran paylaÅŸÄ±m sahnesi (SADECE SÄ°Z GÃ–RÃœRSÃœNÃœZ) -->
    <div id="screenShareStage">
        <video id="screenVideo" autoplay playsinline></video>
        <div class="absolute bottom-20 bg-black bg-opacity-70 px-4 py-2 rounded text-white font-bold">
            ğŸ“¤ EkranÄ±nÄ±z KarÅŸÄ± Tarafa GÃ¶nderiliyor
        </div>
        <div class="absolute bottom-10 text-gray-400 text-sm">
            Bu pencere sadece sizde gÃ¶rÃ¼nÃ¼r
        </div>
    </div>

    <div id="status">Durum: HazÄ±r</div>

    <!-- Basit data mesajÄ± gÃ¶sterimi -->
    <div id="dataMessage" class="data-message"></div>

    <script>
        const EXPECTED_PASSWORD = "123";

        let peer = null;
        let localStream = null;
        let currentCall = null;
        let screenStream = null;
        let isSharing = false;
        let isReceiver = false; // KarÅŸÄ± taraf mÄ±?
        let isFullscreen = false;
        let dataChannel = null;

        const myIdEl = document.getElementById('myId');
        const statusEl = document.getElementById('status');
        const remoteVideoEl = document.getElementById('remoteVideo');
        const localVideoEl = document.getElementById('localVideo');
        const screenStage = document.getElementById('screenShareStage');
        const screenVideo = document.getElementById('screenVideo');
        const shareBtn = document.getElementById('shareBtn');
        const shareBtnText = document.getElementById('shareBtnText');
        const shareIcon = document.getElementById('shareIcon');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const exitFullscreenBtn = document.getElementById('exitFullscreenBtn');
        const screenShareNotice = document.getElementById('screenShareNotice');
        const dataMessageEl = document.getElementById('dataMessage');

        // 1. KamerayÄ± BaÅŸlat
        navigator.mediaDevices.getUserMedia({ 
            video: { width: 1280, height: 720 },
            audio: true 
        })
        .then(stream => {
            localStream = stream;
            localVideoEl.srcObject = stream;
            initPeer();
        })
        .catch(err => {
            statusEl.innerText = "Kamera HatasÄ±: " + err;
        });

        // 2. PeerJS BaÅŸlat
        function initPeer() {
            peer = new Peer();
            
            peer.on('open', id => {
                myIdEl.innerText = id;
                statusEl.innerText = "âœ… ID: " + id.substring(0, 8) + "...";
                showMessage("âœ… BaÄŸlantÄ± hazÄ±r. ID'niz: " + id);
            });

            peer.on('call', call => {
                isReceiver = true;
                statusEl.innerText = "ğŸ“ Gelen Ã§aÄŸrÄ±...";
                showMessage("ğŸ“ Gelen Ã§aÄŸrÄ± var...");
                
                const incomingPassword = call.metadata?.password;
                if (incomingPassword === EXPECTED_PASSWORD) {
                    call.answer(localStream);
                    handleCall(call);
                } else {
                    call.close();
                    statusEl.innerText = "âŒ HatalÄ± ÅŸifre!";
                    showMessage("âŒ HatalÄ± ÅŸifreli Ã§aÄŸrÄ± reddedildi");
                }
            });

            peer.on('error', err => {
                console.error('PeerJS hatasÄ±:', err);
                statusEl.innerText = "âŒ Hata: " + err.type;
                showMessage("âŒ Hata: " + err.type);
            });
        }

        // Mesaj gÃ¶ster
        function showMessage(msg) {
            dataMessageEl.innerText = msg;
            dataMessageEl.style.display = 'block';
            setTimeout(() => {
                dataMessageEl.style.display = 'none';
            }, 3000);
        }

        // 3. Arama Yap
        function connectToPeer() {
            const remoteId = document.getElementById('remoteIdInput').value.trim();
            const password = document.getElementById('passwordInput').value;

            if (!remoteId) {
                showMessage("âš ï¸ LÃ¼tfen karÅŸÄ± tarafÄ±n ID'sini girin!");
                return;
            }
            
            if (password !== EXPECTED_PASSWORD) {
                showMessage("âŒ HatalÄ± ÅŸifre!");
                return;
            }
            
            if (!localStream) {
                showMessage("âŒ Kamera izni gerekli!");
                return;
            }

            statusEl.innerText = "ğŸ“ AranÄ±yor: " + remoteId.substring(0, 8) + "...";
            showMessage("ğŸ“ AranÄ±yor: " + remoteId);
            
            const call = peer.call(remoteId, localStream, { 
                metadata: { password: password } 
            });
            handleCall(call);
        }

        // Ortak Arama YÃ¶netimi
        function handleCall(call) {
            currentCall = call;
            
            call.on('stream', remoteStream => {
                statusEl.innerText = "âœ… BaÄŸlantÄ± Kuruldu!";
                showMessage("âœ… BaÄŸlantÄ± kuruldu!");
                remoteVideoEl.srcObject = remoteStream;
                
                // Data channel oluÅŸtur
                try {
                    dataChannel = call.peerConnection.createDataChannel('chat');
                    
                    dataChannel.onopen = () => {
                        console.log('Data kanalÄ± aÃ§Ä±ldÄ±');
                        showMessage("ğŸ“¡ Data kanalÄ± aÃ§Ä±ldÄ±");
                    };
                    
                    dataChannel.onmessage = (event) => {
                        console.log('Data mesajÄ± alÄ±ndÄ±:', event.data);
                        handleDataMessage(JSON.parse(event.data));
                    };
                    
                    dataChannel.onerror = (error) => {
                        console.error('Data channel error:', error);
                    };
                } catch (e) {
                    console.log('Data channel oluÅŸturma hatasÄ±:', e);
                }
            });
            
            // Gelen data channel'Ä± dinle
            call.peerConnection.ondatachannel = (event) => {
                dataChannel = event.channel;
                
                dataChannel.onopen = () => {
                    console.log('Data kanalÄ± aÃ§Ä±ldÄ± (alÄ±cÄ±)');
                    showMessage("ğŸ“¡ Data kanalÄ± aÃ§Ä±ldÄ±");
                };
                
                dataChannel.onmessage = (event) => {
                    console.log('Data mesajÄ± alÄ±ndÄ±:', event.data);
                    handleDataMessage(JSON.parse(event.data));
                };
            };
            
            call.on('close', () => {
                statusEl.innerText = "ğŸ”´ BaÄŸlantÄ± kesildi";
                showMessage("ğŸ”´ BaÄŸlantÄ± kesildi");
                stopScreenShare();
                exitFullscreen();
                
                // ButonlarÄ± gizle
                fullscreenBtn.style.display = 'none';
                screenShareNotice.style.display = 'none';
                exitFullscreenBtn.style.display = 'none';
            });
            
            call.on('error', err => {
                statusEl.innerText = "âŒ Ã‡aÄŸrÄ± hatasÄ±: " + err.message;
                showMessage("âŒ Ã‡aÄŸrÄ± hatasÄ±: " + err.message);
            });
        }

        // Data mesajlarÄ±nÄ± iÅŸle
        function handleDataMessage(message) {
            console.log('Data message received:', message);
            
            if (message.type === 'screenShareStarted') {
                // KarÅŸÄ± taraf ekran paylaÅŸÄ±mÄ± baÅŸlattÄ±
                screenShareNotice.style.display = 'block';
                fullscreenBtn.style.display = 'block';
                statusEl.innerText = "ğŸ“º Ekran paylaÅŸÄ±mÄ± izleniyor";
                showMessage("ğŸ“º KarÅŸÄ± taraf ekran paylaÅŸÄ±mÄ± baÅŸlattÄ±");
                
            } else if (message.type === 'screenShareStopped') {
                // KarÅŸÄ± taraf ekran paylaÅŸÄ±mÄ± durdurdu
                screenShareNotice.style.display = 'none';
                fullscreenBtn.style.display = 'none';
                exitFullscreenBtn.style.display = 'none';
                statusEl.innerText = "âœ… BaÄŸlantÄ± kuruldu";
                showMessage("ğŸ“´ KarÅŸÄ± taraf ekran paylaÅŸÄ±mÄ± durdurdu");
                exitFullscreen();
            }
        }

        // Data mesajÄ± gÃ¶nder
        function sendDataMessage(message) {
            if (dataChannel && dataChannel.readyState === 'open') {
                dataChannel.send(JSON.stringify(message));
                console.log('Data message sent:', message);
            } else {
                console.warn('Data channel not ready');
                // Alternatif olarak call Ã¼zerinden gÃ¶nder
                try {
                    if (currentCall && currentCall.send) {
                        currentCall.send(JSON.stringify(message));
                    }
                } catch (e) {
                    console.error('Failed to send message:', e);
                }
            }
        }

        // --- EKRAN PAYLAÅIMI ---
        async function toggleScreenShare() {
            if (!currentCall) {
                showMessage("âš ï¸ Ã–nce bir gÃ¶rÃ¼ÅŸme baÅŸlatmalÄ±sÄ±nÄ±z!");
                return;
            }

            if (!isSharing) {
                try {
                    // Ekran paylaÅŸÄ±mÄ±nÄ± baÅŸlat
                    screenStream = await navigator.mediaDevices.getDisplayMedia({ 
                        video: {
                            cursor: "always",
                            displaySurface: "monitor"
                        },
                        audio: true 
                    });

                    // Kendi ekranÄ±nÄ±zÄ± kendinize gÃ¶ster
                    screenStage.style.display = 'flex';
                    screenVideo.srcObject = screenStream;
                    
                    // Buton gÃ¼ncelleme
                    shareBtnText.innerText = "Durdur";
                    shareIcon.innerText = "â¹ï¸";
                    shareBtn.classList.remove('bg-purple-600');
                    shareBtn.classList.add('bg-red-600');
                    statusEl.innerText = "ğŸ“¤ Ekran paylaÅŸÄ±lÄ±yor...";
                    showMessage("ğŸ“¤ Ekran paylaÅŸÄ±mÄ± baÅŸlatÄ±ldÄ±");

                    // KarÅŸÄ± tarafa ekran paylaÅŸÄ±mÄ± gÃ¶nder
                    const screenVideoTrack = screenStream.getVideoTracks()[0];
                    const senders = currentCall.peerConnection.getSenders();
                    const videoSender = senders.find(s => s.track && s.track.kind === 'video');
                    
                    if (videoSender && screenVideoTrack) {
                        videoSender.replaceTrack(screenVideoTrack);
                        console.log('Ekran paylaÅŸÄ±mÄ± karÅŸÄ± tarafa gÃ¶nderildi');
                    }

                    // KarÅŸÄ± tarafa bildirim gÃ¶nder
                    sendDataMessage({ type: 'screenShareStarted', timestamp: Date.now() });

                    // Ekran paylaÅŸÄ±mÄ± durdurulursa
                    screenVideoTrack.onended = () => {
                        console.log('Ekran paylaÅŸÄ±mÄ± kullanÄ±cÄ± tarafÄ±ndan durduruldu');
                        stopScreenShare();
                    };

                    isSharing = true;

                } catch (err) {
                    console.error("Ekran paylaÅŸÄ±mÄ± iptal edildi:", err);
                    statusEl.innerText = "âŒ PaylaÅŸÄ±m iptal edildi";
                    showMessage("âŒ Ekran paylaÅŸÄ±mÄ± iptal edildi");
                }
            } else {
                stopScreenShare();
            }
        }

        function stopScreenShare() {
            if (!isSharing) return;

            console.log('Ekran paylaÅŸÄ±mÄ± durduruluyor...');

            // KarÅŸÄ± tarafa bildirim gÃ¶nder
            sendDataMessage({ type: 'screenShareStopped', timestamp: Date.now() });

            // Ekran paylaÅŸÄ±mÄ±nÄ± kapat
            if (screenStream) {
                screenStream.getTracks().forEach(track => {
                    track.stop();
                    console.log('Track stopped:', track.kind);
                });
                screenStream = null;
            }

            // Kendi ekranÄ±nÄ±zÄ± kapat
            screenStage.style.display = 'none';
            
            // Buton gÃ¼ncelleme
            shareBtnText.innerText = "PaylaÅŸ";
            shareIcon.innerText = "ğŸ“º";
            shareBtn.classList.remove('bg-red-600');
            shareBtn.classList.add('bg-purple-600');
            statusEl.innerText = "âœ… BaÄŸlantÄ± kuruldu";
            showMessage("ğŸ“´ Ekran paylaÅŸÄ±mÄ± durduruldu");

            // Kendi kameranÄ±zÄ± geri yÃ¼kle
            if (currentCall && localStream) {
                const cameraTrack = localStream.getVideoTracks()[0];
                const senders = currentCall.peerConnection.getSenders();
                const videoSender = senders.find(s => s.track && s.track.kind === 'video');
                
                if (videoSender && cameraTrack) {
                    videoSender.replaceTrack(cameraTrack);
                    console.log('Kamera geri yÃ¼klendi');
                }
            }

            isSharing = false;
        }

        // TAM EKRAN FONKSÄ°YONLARI
        function toggleFullscreen() {
            const elem = document.documentElement;
            
            if (!document.fullscreenElement) {
                // Tam ekrana gir
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
                
                fullscreenBtn.style.display = 'none';
                exitFullscreenBtn.style.display = 'block';
                isFullscreen = true;
                
                console.log('Tam ekrana girildi');
                showMessage("ğŸ–¥ï¸ Tam ekran modu");
                
            } else {
                exitFullscreen();
            }
        }

        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
            
            fullscreenBtn.style.display = 'block';
            exitFullscreenBtn.style.display = 'none';
            isFullscreen = false;
            
            console.log('Tam ekrandan Ã§Ä±kÄ±ldÄ±');
            showMessage("ğŸ“± Normal mod");
        }

        // Fullscreen deÄŸiÅŸimlerini dinle
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('msfullscreenchange', handleFullscreenChange);

        function handleFullscreenChange() {
            if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                // Tam ekrandayÄ±z
                fullscreenBtn.style.display = 'none';
                exitFullscreenBtn.style.display = 'block';
                isFullscreen = true;
                console.log('Fullscreen event: entered');
            } else {
                // Tam ekrandan Ã§Ä±ktÄ±k
                fullscreenBtn.style.display = 'block';
                exitFullscreenBtn.style.display = 'none';
                isFullscreen = false;
                console.log('Fullscreen event: exited');
            }
        }

        // ESC tuÅŸu ile tam ekrandan Ã§Ä±k
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && isFullscreen) {
                exitFullscreen();
            }
            
            // F tuÅŸu ile tam ekran
            if (e.key === 'F' || e.key === 'f') {
                e.preventDefault();
                toggleFullscreen();
            }
        });

        // ButonlarÄ± test etmek iÃ§in (sadece geliÅŸtirme)
        window.testButtons = function() {
            console.log('Test: ButonlarÄ± gÃ¶ster');
            fullscreenBtn.style.display = 'block';
            screenShareNotice.style.display = 'block';
            exitFullscreenBtn.style.display = 'block';
            showMessage("ğŸ”§ Test: Butonlar gÃ¶steriliyor");
        };

        // Pencere kapatÄ±ldÄ±ÄŸÄ±nda
        window.addEventListener('beforeunload', () => {
            console.log('Pencere kapatÄ±lÄ±yor...');
            if (currentCall) {
                currentCall.close();
            }
            if (screenStream) {
                screenStream.getTracks().forEach(track => track.stop());
            }
        });

        // Hata ayÄ±klama
        window.debugInfo = function() {
            console.log('=== DEBUG INFO ===');
            console.log('isReceiver:', isReceiver);
            console.log('isSharing:', isSharing);
            console.log('isFullscreen:', isFullscreen);
            console.log('currentCall:', currentCall ? 'Connected' : 'None');
            console.log('dataChannel:', dataChannel ? dataChannel.readyState : 'None');
            console.log('screenStream:', screenStream ? 'Active' : 'None');
            console.log('==================');
            
            showMessage("ğŸ› Debug: Konsola bakÄ±n");
        };
    </script>
</body>
</html>